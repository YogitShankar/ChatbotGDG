{
    "url": "https://codeforces.com/problemset/problem/2029/H",
    "title": "H. Message Spread",
    "tags": [
        "bitmasks",
        "brute force",
        "combinatorics",
        "dp",
        "*3500"
    ],
    "content": "H. Message Spreadtime limit per test12 secondsmemory limit per test1024 megabytesinputstandard inputoutputstandard outputGiven is an undirected graph with \ud835\udc5bn vertices and \ud835\udc5am edges. Each edge connects two vertices (\ud835\udc62,\ud835\udc63)(u,v) and has a probability of \ud835\udc5d\ud835\udc5epq of appearing each day.Initially, vertex 11 has a message. At the end of the day, a vertex has a message if and only if itself or at least one of the vertices adjacent to it had the message the day before. Note that each day, each edge chooses its appearance independently.Calculate the expected number of days before all the vertices have the message, modulo 998244353998244353.InputThe first line contains two integers \ud835\udc5bn and \ud835\udc5am (1\u2264\ud835\udc5b\u2264211\u2264n\u226421, \ud835\udc5b\u22121\u2264\ud835\udc5a\u2264\ud835\udc5b(\ud835\udc5b\u22121)2n\u22121\u2264m\u2264n(n\u22121)2).Then \ud835\udc5am lines follow, each containing four integers \ud835\udc62u, \ud835\udc63v, \ud835\udc5dp, and \ud835\udc5eq (1\u2264\ud835\udc62\u2260\ud835\udc63\u2264\ud835\udc5b1\u2264u\u2260v\u2264n, 1\u2264\ud835\udc5d<\ud835\udc5e<9982443531\u2264p<q<998244353, gcd(\ud835\udc5d,\ud835\udc5e)=1gcd(p,q)=1)\u00a0\u2014 there is an undirected edge between \ud835\udc62u and \ud835\udc63v, and it has a probability of appearance of \ud835\udc5d\ud835\udc5epq each day. It is guaranteed that there are no self-loops or multiple-edges in the graph and that the graph is connected if all of the edges appear.Additional constraint in the input: Let \ud835\udc54\ud835\udc56,\ud835\udc57gi,j be the probability of appearance of the edge between \ud835\udc56i and \ud835\udc57j (\ud835\udc54\ud835\udc56,\ud835\udc57=0gi,j=0 if there is no edge between \ud835\udc56i and \ud835\udc57j). It is guaranteed that for any \ud835\udc46\u2286{1,2,\u2026,\ud835\udc5b}S\u2286{1,2,\u2026,n} (|\ud835\udc46|\u22651|S|\u22651), \u220f\ud835\udc56\u2208\ud835\udc46(\u220f\ud835\udc57\u2208{1,2,\u2026,\ud835\udc5b}\u2216\ud835\udc46(1\u2212\ud835\udc54\ud835\udc56,\ud835\udc57))\u22621(mod998244353).\u220fi\u2208S(\u220fj\u2208{1,2,\u2026,n}\u2216S(1\u2212gi,j))\u22621(mod998244353).OutputPrint a single integer in the only line of the output\u00a0\u2014 the expected number of days, modulo 998244353998244353.Formally, let \ud835\udc40=998244353M=998244353. It can be shown that the exact answer can be expressed as an irreducible fraction \ud835\udc5d\ud835\udc5epq, where \ud835\udc5dp and \ud835\udc5eq are integers and \ud835\udc5e\u22620(mod\ud835\udc40)q\u22620(modM). Output the integer equal to \ud835\udc5d\u22c5\ud835\udc5e\u22121mod\ud835\udc40p\u22c5q\u22121modM. In other words, output such an integer \ud835\udc65x that 0\u2264\ud835\udc65<\ud835\udc400\u2264x<M and \ud835\udc65\u22c5\ud835\udc5e\u2261\ud835\udc5d(mod\ud835\udc40)x\u22c5q\u2261p(modM). ExamplesInputCopy2 11 2 1 10OutputCopy10InputCopy3 31 2 1 21 3 1 22 3 1 2OutputCopy887328316InputCopy1 0OutputCopy0InputCopy5 81 2 1 111 3 2 111 4 3 111 5 4 112 4 5 112 5 6 113 4 7 114 5 8 11OutputCopy469993557InputCopy21 221 2 3 42 3 4 53 4 5 65 6 7 86 7 8 97 8 9 108 9 2 39 10 3 410 11 4 511 12 5 612 13 6 713 14 7 814 15 8 915 16 9 1016 17 2 317 18 3 418 19 4 519 20 5 620 21 6 71 10 100 100115 4 147 2204 11 1 998244352OutputCopy299529765NoteIn the first test, the answer is equal to the expected number of days before the only edge in the graph first appears, and that is 10.1=1010.1=10.In the second test, the answer is equal to 209209 before it is taken modulo 998244353998244353.In the third test, the only vertex already has the message, so the answer is 00...."
}